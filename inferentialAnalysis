# Importing the libraries that we will need for data handling and visualisation
import pandas as pd
import numpy as np
import matplotlib.pyplot as plt
import seaborn as sns
from scipy.stats import chi2_contingency
from math import sqrt

# Loading cleaned dataset which was prepared earlier 
cleaned_df1 = pd.read_csv("CleanDataset1.csv")
cleaned_df1["time_to_food"] = cleaned_df1["time_to_food"].apply(pd.to_timedelta, errors="coerce")

# 1. Chi-square Test: Risk-taking vs Reward
print("\nChi-square Test: Risk vs Reward")

# Contingency table
crosstab = cleaned_df1.groupby(["risk", "reward"]).size().unstack(fill_value=0)
chi2, p, dof, expected = chi2_contingency(crosstab)

print("Contingency Table:")
print(crosstab)
print(f"chi2 = {chi2:.2f}, p = {p:.4f}, dof = {dof}")

# Effect size: Cramér's V
n = crosstab.sum().sum()
cramers_v = sqrt(chi2 / (n * (min(crosstab.shape) - 1)))
print(f"Cramér's V = {cramers_v:.3f} (effect size)")

if p < 0.05:
    print("Significant relationship: Risk-taking behaviour is linked to rewards.")
else:
    print("No significant relationship between risk-taking and rewards.")

# Plot: Risk vs Reward counts
sns.heatmap(crosstab, annot=True, fmt="d", cmap="Blues")
plt.title("Risk-taking vs Reward (Counts)")
plt.show()